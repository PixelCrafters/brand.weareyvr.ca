<!doctype html>
<html>
<head>
  <title>Tangents</title>
  <!-- <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
  <!-- <script src="https://raw.github.com/jonobr1/two.js/master/build/two.js" charset="utf-8"></script> -->
  <style>
  * { box-sizing: border-box; }
  body { background: #444; font-family: Helvetica; }
  canvas {
    background: #3f3f3f;
    float: left;
    margin: 50px 100px 50px 50px;
  }
  .controls {
    float: left;
  }
  h3, .outlines { margin-top: 40px; }
  </style>
</head>
<body>
  <canvas id="graphic" width="475" height="500">
  </canvas>
  <div class="controls">
    <h3>One</h3> <!-- Top left -->
    <label>X <input type="range" min="0" max="475" step="1" value="49" name="one.x"></label>
    <label>Y <input type="range" min="0" max="500" step="1" value="49" name="one.y"></label>
    <label>R <input type="range" min="0" max="100" step="1" value="46" name="one.radius"></label>
    <h3>Two</h3> <!-- Top right -->
    <label>X <input type="range" min="0" max="475" step="1" value="426" name="two.x"></label>
    <label>Y <input type="range" min="0" max="500" step="1" value="49" name="two.y"></label>
    <label>R <input type="range" min="0" max="100" step="1" value="46" name="two.radius"></label>
    <h3>Three</h3> <!-- Bottom right -->
    <label>X <input type="range" min="0" max="475" step="1" value="426" name="three.x"></label>
    <label>Y <input type="range" min="0" max="500" step="1" value="451" name="three.y"></label>
    <label>R <input type="range" min="0" max="100" step="1" value="46" name="three.radius"></label>
    <h3>Four</h3> <!-- Bottom left -->
    <label>X <input type="range" min="0" max="475" step="1" value="49" name="four.x"></label>
    <label>Y <input type="range" min="0" max="500" step="1" value="451" name="four.y"></label>
    <label>R <input type="range" min="0" max="100" step="1" value="46" name="four.radius"></label>
    <div class="outlines">
      <label><input type="checkbox"> Outlines</label>
    </div>
  </div>
  <script>
  // For some d3 help: http://jsfiddle.net/D5k8x/

  // Defaults

  var outlines = false;

  // Top left
  var one = {
    radius: 46,
    x: 46 + 3,
    y: 46 + 3,
  };

  // Top right
  var two = {
    radius: 46,
    x: 475 - (46 + 3),
    y: 46 + 3,
  }

  // Bottom right
  var three = {
    radius: 46,
    // x: 475 - (46 + 3),
    x: (475 / 2) + 10,
    y: 500 - (46 + 3),
  };

  // Bottom left
  var four = {
    radius: 46,
    // x: 46 + 3,
    x: (475 / 2) - 10,
    y: 500 - (46 + 3),
  }

  // Controls

  var inputs = document.querySelectorAll('input[type="range"]');
  for (var i = 0; i < inputs.length; i++) {
    inputs[i].addEventListener('input', function(e) {
      eval(this.name + ' = ' + this.value); // DIRTY!
      draw();
    });
  }
  document.querySelector('input[type="checkbox"]').addEventListener('click', function(e) {
    outlines = this.checked;
    draw();
  });

  function draw() {
    var c = document.getElementById('graphic');
    var ctx = c.getContext("2d");
    
    ctx.clearRect(0,0,500,500);

    ctx.lineWidth = 3;

    if (outlines) {
      ctx.lineWidth = 2;

      ctx.strokeStyle = "#ff0000";
      ctx.beginPath();
      ctx.arc(one.x,one.y,one.radius,0, 2*Math.PI);
      ctx.stroke();

      ctx.strokeStyle = "#00ff00";
      ctx.beginPath();
      ctx.arc(two.x,two.y,two.radius,0, 2*Math.PI);
      ctx.stroke();

      ctx.strokeStyle = "#0000ff";
      ctx.beginPath();
      ctx.arc(three.x,three.y,three.radius,0, 2*Math.PI);
      ctx.stroke();

      ctx.strokeStyle = "#ff00ff";
      ctx.beginPath();
      ctx.arc(four.x,four.y,four.radius,0, 2*Math.PI);
      ctx.stroke();
    }

    // Reset colours

    ctx.strokeStyle = "#ffffff";
    ctx.lineWidth = 3;
    ctx.beginPath();

    // Outside tangents

    var angleOneTwo = Math.atan2(two.y - one.y, two.x - one.x);
    var angleOneToTwoTangent = angleOneTwo + (Math.atan(-0.5) * Math.PI)

    ctx.beginPath();
    ctx.moveTo(one.x + Math.cos(angleOneToTwoTangent)*one.radius, one.y + Math.sin(angleOneToTwoTangent)*one.radius);
    ctx.lineTo(two.x + Math.cos(angleOneToTwoTangent)*two.radius, two.y + Math.sin(angleOneToTwoTangent)*two.radius);
    ctx.stroke();

    var angleThreeFour = Math.atan2(four.y - three.y, four.x - three.x);
    var angleThreeToFourTangent = angleThreeFour + (Math.atan(-0.5) * Math.PI)

    ctx.beginPath();
    ctx.moveTo(three.x + Math.cos(angleThreeToFourTangent)*three.radius, three.y + Math.sin(angleThreeToFourTangent)*three.radius);
    ctx.lineTo(four.x + Math.cos(angleThreeToFourTangent)*four.radius, four.y + Math.sin(angleThreeToFourTangent)*four.radius);
    ctx.stroke();

    // Inside tangents

    var angleTwoFour = Math.atan2(four.y - two.y, four.x - two.x);
    var angleTwoToFourTangent = angleTwoFour + (Math.atan(-0.5) * Math.PI)
    var angleTwoToFourTangentReverse = angleTwoFour + (Math.tan(0.5) * Math.PI)

    ctx.beginPath();
    ctx.moveTo(two.x + Math.cos(angleTwoToFourTangent)*two.radius, two.y + Math.sin(angleTwoToFourTangent)*two.radius);
    ctx.lineTo(four.x + Math.cos(angleTwoToFourTangentReverse)*four.radius, four.y + Math.sin(angleTwoToFourTangentReverse)*four.radius);
    ctx.stroke();

    var angleThreeOne = Math.atan2(one.y - three.y, one.x - three.x);
    var angleThreeToOneTangent = angleThreeOne + (Math.tan(-0.5) * Math.PI)
    var angleThreeToOneTangentReverse = angleThreeOne + (Math.atan(0.5) * Math.PI)

    ctx.beginPath();
    ctx.moveTo(three.x + Math.cos(angleThreeToOneTangentReverse)*three.radius, three.y + Math.sin(angleThreeToOneTangentReverse)*three.radius);
    ctx.lineTo(one.x + Math.cos(angleThreeToOneTangent)*one.radius, one.y + Math.sin(angleThreeToOneTangent)*one.radius);
    ctx.stroke();

    // Arcs

    // One
    ctx.beginPath();
    ctx.arc(one.x,one.y,one.radius,angleThreeToOneTangent, angleOneToTwoTangent);
    ctx.stroke();

    // Two
    ctx.beginPath();
    ctx.arc(two.x,two.y,two.radius,angleOneToTwoTangent,angleTwoToFourTangent);
    ctx.stroke();

    // Three
    ctx.beginPath();
    ctx.arc(three.x,three.y,three.radius,angleThreeToOneTangentReverse,angleThreeToFourTangent);
    ctx.stroke();

    // Four
    ctx.beginPath();
    ctx.arc(four.x,four.y,four.radius,angleThreeToFourTangent,angleTwoToFourTangentReverse);
    ctx.stroke();
  }
  draw();
  </script>
</body>
</html>